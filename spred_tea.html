<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ç»¸ä¹‹è·¯èŒ¶å¶ä¼ æ’­å†å²</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- åŠ¨ç”»åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    
    <!-- Leaflet.js åœ°å›¾åº“ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Tailwind é…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3A7D44',  // èŒ¶å¶ç»¿
                        secondary: '#8B4513',
                        accent: '#D4AF37',
                        background: '#F5F5F0',
                        foreground: '#2F1B14'
                    }
                }
            }
        }
    </script>
    
    <style>
        /* èŒ¶å¶çº¹ç†é£æ ¼èƒŒæ™¯ */
        body {
            background: linear-gradient(135deg, #F5F5F0 0%, #E8E4D9 100%);
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(58, 125, 68, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 69, 19, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(212, 175, 55, 0.1) 0%, transparent 50%);
            min-height: 100vh;
            font-family: 'serif', 'å®‹ä½“', 'SimSun', serif;
        }
        
        /* èŒ¶å¶çº¹ç†æ•ˆæœ */
        .tea-texture {
            background: linear-gradient(45deg, 
                rgba(58, 125, 68, 0.1) 25%, 
                transparent 25%, 
                transparent 75%, 
                rgba(58, 125, 68, 0.1) 75%),
                linear-gradient(-45deg, 
                rgba(58, 125, 68, 0.1) 25%, 
                transparent 25%, 
                transparent 75%, 
                rgba(58, 125, 68, 0.1) 75%);
            background-size: 20px 20px;
        }
        
        /* èŒ¶å¶å¡ç‰‡æ ·å¼ */
        .tea-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(58, 125, 68, 0.3);
            transition: all 0.3s ease;
        }
        
        .tea-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: rgba(58, 125, 68, 0.6);
        }
        
        /* æ—¶é—´è½´æ ·å¼ */
        .timeline-container {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #3A7D44, #8B4513);
            transform: translateX(-50%);
            border-radius: 2px;
        }
        
        .timeline-item {
            position: relative;
            margin: 60px 0;
            opacity: 0;
            transform: translateY(50px);
        }
        
        .timeline-item.left {
            text-align: right;
            padding-right: calc(50% + 40px);
        }
        
        .timeline-item.right {
            text-align: left;
            padding-left: calc(50% + 40px);
        }
        
        .timeline-dot {
            position: absolute;
            left: 50%;
            top: 20px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #3A7D44, #8B4513);
            border-radius: 50%;
            transform: translateX(-50%);
            border: 4px solid #F5F5F0;
            box-shadow: 0 0 20px rgba(58, 125, 68, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .timeline-dot:hover {
            transform: translateX(-50%) scale(1.2);
            box-shadow: 0 0 30px rgba(58, 125, 68, 0.8);
        }
        
        .timeline-dot.active {
            background: linear-gradient(135deg, #8B4513, #3A7D44);
            transform: translateX(-50%) scale(1.3);
            box-shadow: 0 0 40px rgba(139, 69, 19, 0.8);
        }
        
        .timeline-content {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(58, 125, 68, 0.3);
            transition: all 0.3s ease;
        }
        
        .timeline-content:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: rgba(58, 125, 68, 0.6);
        }
        
        /* åœ°å›¾å®¹å™¨æ ·å¼ */
        .map-container {
            position: relative;
            background: linear-gradient(135deg, #2C1810 0%, #4A2C1A 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 40px 0;
            overflow: hidden;
        }
        
        .map-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(58, 125, 68, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 69, 19, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        /* Leafletåœ°å›¾æ ·å¼ */
        #realMap {
            width: 100%;
            height: 600px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(58, 125, 68, 0.3);
        }
        
        /* æœä»£é€‰æ‹©å™¨æ ·å¼ */
        .dynasty-selector {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(58, 125, 68, 0.3);
        }
        
        .dynasty-selector select {
            background: linear-gradient(135deg, #3A7D44, #8B4513);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            outline: none;
        }
        
        /* è‡ªå®šä¹‰æ ‡è®°ç‚¹æ ·å¼ */
        .custom-marker {
            background: linear-gradient(135deg, #3A7D44, #8B4513);
            border: 3px solid #F5F5F0;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(58, 125, 68, 0.5);
            transition: all 0.3s ease;
        }
        
        .custom-marker:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(58, 125, 68, 0.8);
        }
        
        /* å¼¹çª—æ ·å¼ */
        .leaflet-popup-content-wrapper {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 2px solid rgba(58, 125, 68, 0.3);
        }
        
        .leaflet-popup-content {
            margin: 16px;
            font-family: 'serif', 'å®‹ä½“', 'SimSun', serif;
        }
        
        .popup-title {
            font-size: 18px;
            font-weight: bold;
            color: #2F1B14;
            margin-bottom: 8px;
        }
        
        .popup-description {
            color: #8B4513;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        .popup-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .popup-tag {
            background: linear-gradient(135deg, #3A7D44, #8B4513);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* æ§åˆ¶é¢æ¿æ ·å¼ */
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(58, 125, 68, 0.3);
        }
        
        .period-btn {
            background: linear-gradient(135deg, #3A7D44, #8B4513);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 4px;
        }
        
        .period-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(58, 125, 68, 0.4);
        }
        
        .period-btn.active {
            background: linear-gradient(135deg, #8B4513, #3A7D44);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 69, 19, 0.5);
        }
        
        /* ä¿¡æ¯å¡ç‰‡æ ·å¼ */
        .info-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #3A7D44;
            opacity: 0;
            transform: translateX(-20px);
        }
        
        .info-card.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .timeline-item.left,
            .timeline-item.right {
                text-align: left;
                padding-left: 60px;
                padding-right: 20px;
            }
            
            .timeline-line {
                left: 30px;
            }
            
            .timeline-dot {
                left: 30px;
            }
            
            .control-panel {
                padding: 16px;
            }
            
            .period-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
        
        /* èŒ¶å¶ç±»å‹å±•ç¤ºåŒº */
        .tea-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin: 40px 0;
        }
        
        .tea-type-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(58, 125, 68, 0.3);
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .tea-type-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: rgba(58, 125, 68, 0.6);
        }
        
        .tea-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .tea-name {
            font-size: 20px;
            font-weight: bold;
            color: #2F1B14;
            margin-bottom: 8px;
        }
        
        .tea-description {
            color: #8B4513;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <!-- ä¸»å®¹å™¨ -->
    <div class="container mx-auto px-4 py-8">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <header class="text-center mb-12">
            <h1 class="text-5xl font-bold text-foreground mb-4 tea-texture">
                ä¸ç»¸ä¹‹è·¯èŒ¶å¶ä¼ æ’­å†å²
            </h1>
            <p class="text-xl text-secondary max-w-3xl mx-auto leading-relaxed">
                ç©¿è¶Šåƒå¹´èŒ¶è·¯ï¼Œæ¢ç´¢èŒ¶å¶å¦‚ä½•ä»ä¸­å›½èµ°å‘ä¸–ç•Œï¼Œæˆä¸ºå…¨çƒæœ€å—æ¬¢è¿çš„é¥®å“ä¹‹ä¸€
            </p>
        </header>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel mb-8">
            <h3 class="text-2xl font-bold text-foreground mb-4">é€‰æ‹©èŒ¶å¶ä¼ æ’­æ—¶æœŸ</h3>
            <div class="flex flex-wrap justify-center">
                <button class="period-btn active" onclick="showPeriod('tang')" data-period="tang">
                    å”ä»£èµ·æºæœŸ (618-907å¹´)
                </button>
                <button class="period-btn" onclick="showPeriod('song')" data-period="song">
                    å®‹å…ƒå‘å±•æœŸ (960-1368å¹´)
                </button>
                <button class="period-btn" onclick="showPeriod('ming')" data-period="ming">
                    æ˜ä»£ç¹è£æœŸ (1368-1644å¹´)
                </button>
                <button class="period-btn" onclick="showPeriod('qing')" data-period="qing">
                    æ¸…ä»£é¼ç››æœŸ (1644-1912å¹´)
                </button>
            </div>
        </div>
        
        <!-- äº¤äº’åœ°å›¾ -->
        <div class="map-container">
            <h3 class="text-3xl font-bold text-primary mb-6 text-center">ä¸ç»¸ä¹‹è·¯èŒ¶å¶ä¼ æ’­è·¯çº¿å›¾</h3>
            
            <!-- æœä»£é€‰æ‹©å™¨ -->
            <div class="dynasty-selector">
                <label class="text-foreground font-bold mr-4">é€‰æ‹©æ—¶æœŸï¼š</label>
                <select id="dynastySelect" onchange="switchDynasty(this.value)">
                    <option value="tang">å”ä»£ (618-907å¹´)</option>
                    <option value="song">å®‹å…ƒ (960-1368å¹´)</option>
                    <option value="ming">æ˜ä»£ (1368-1644å¹´)</option>
                    <option value="qing">æ¸…ä»£ (1644-1912å¹´)</option>
                </select>
            </div>
            
            <!-- LeafletçœŸå®åœ°å›¾ -->
            <div id="realMap"></div>
            
            <!-- åœ°å›¾è¯´æ˜ -->
            <div class="mt-6 text-center">
                <p class="text-primary font-bold">ç‚¹å‡»åœ°å›¾æ ‡è®°ç‚¹æŸ¥çœ‹èŒ¶å¶è´¸æ˜“åŸå¸‚è¯¦ç»†ä¿¡æ¯ | åˆ‡æ¢æ—¶æœŸæŸ¥çœ‹ä¸åŒé˜¶æ®µçš„èŒ¶å¶ä¼ æ’­è·¯çº¿</p>
            </div>
        </div>
        
        <!-- åŸå¸‚ä¿¡æ¯å¡ç‰‡ -->
        <div id="cityInfo" class="info-card">
            <h4 class="text-2xl font-bold text-foreground mb-3">é€‰æ‹©åŸå¸‚æŸ¥çœ‹èŒ¶å¶è´¸æ˜“ä¿¡æ¯</h4>
            <p class="text-secondary">ç‚¹å‡»åœ°å›¾ä¸Šçš„åŸå¸‚èŠ‚ç‚¹ï¼Œäº†è§£è¯¥åŸå¸‚åœ¨èŒ¶å¶ä¼ æ’­ä¸­çš„é‡è¦ä½œç”¨å’Œå†å²æ•…äº‹ã€‚</p>
        </div>
        
        <!-- èŒ¶å¶ç±»å‹å±•ç¤ºåŒº -->
        <div class="tea-types">
            <div class="tea-type-card">
                <div class="tea-icon">ğŸƒ</div>
                <div class="tea-name">ç»¿èŒ¶</div>
                <div class="tea-description">æœ€æ—©é€šè¿‡ä¸ç»¸ä¹‹è·¯ä¼ æ’­çš„èŒ¶ç±»ï¼Œä¿ç•™äº†èŒ¶å¶æœ€åŸå§‹çš„é£å‘³å’Œè¥å…»æˆåˆ†ã€‚</div>
            </div>
            <div class="tea-type-card">
                <div class="tea-icon">ğŸ‚</div>
                <div class="tea-name">çº¢èŒ¶</div>
                <div class="tea-description">å…¨å‘é…µèŒ¶ï¼Œé€‚åˆé•¿é€”è¿è¾“ï¼Œæˆä¸ºè¥¿æ–¹æœ€å—æ¬¢è¿çš„èŒ¶ç±»ä¹‹ä¸€ã€‚</div>
            </div>
            <div class="tea-type-card">
                <div class="tea-icon">ğŸµ</div>
                <div class="tea-name">ç –èŒ¶</div>
                <div class="tea-description">å‹ç¼©èŒ¶ï¼Œä¾¿äºé©¼é˜Ÿè¿è¾“ï¼Œæ˜¯è‰åŸæ°‘æ—çš„é‡è¦é¥®å“ã€‚</div>
            </div>
            <div class="tea-type-card">
                <div class="tea-icon">ğŸŒ¿</div>
                <div class="tea-name">ä¹Œé¾™èŒ¶</div>
                <div class="tea-description">åŠå‘é…µèŒ¶ï¼Œå…¼å…·ç»¿èŒ¶æ¸…é¦™å’Œçº¢èŒ¶é†‡åšï¼Œæ·±å—ä¸œå—äºšå–œçˆ±ã€‚</div>
            </div>
        </div>
        
        <!-- æ—¶é—´è½´ -->
        <div class="timeline-container mt-16">
            <div class="timeline-line"></div>
            
            <!-- å”ä»£æ—¶æœŸ -->
            <div class="timeline-item left" data-period="tang">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">å”ä»£ - èŒ¶å¶ä¼ æ’­çš„èµ·æº</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">ã€ŠèŒ¶ç»ã€‹ä¸å”ä»£èŒ¶æ–‡åŒ–</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        å”ä»£æ˜¯èŒ¶å¶æ–‡åŒ–å½¢æˆçš„å…³é”®æ—¶æœŸï¼Œé™†ç¾½çš„ã€ŠèŒ¶ç»ã€‹ç³»ç»Ÿæ€»ç»“äº†èŒ¶å¶ç”Ÿäº§ä¸é¥®ç”¨æ–¹æ³•ã€‚
                        èŒ¶å¶å¼€å§‹é€šè¿‡ä¸ç»¸ä¹‹è·¯å‘è¥¿åŸŸä¼ æ’­ï¼Œä¸»è¦ä½œä¸ºè´µé‡ç¤¼å“å’Œè¯æï¼Œå°šæœªå½¢æˆå¤§è§„æ¨¡è´¸æ˜“ã€‚
                        èŒ¶é©¬å¤é“åˆç°é›å½¢ï¼Œä¸ºåæ¥çš„èŒ¶å¶è´¸æ˜“å¥ å®šäº†åŸºç¡€ã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">æ–‡åŒ–èµ·æº</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">èŒ¶é©¬å¤é“</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">é™†ç¾½ã€ŠèŒ¶ç»ã€‹</span>
                    </div>
                </div>
            </div>
            
            <div class="timeline-item right" data-period="tang">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">èŒ¶é©¬è´¸æ˜“çš„é›å½¢</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-accent/20 to-primary/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">å”ä»£èŒ¶é©¬äº¤æ˜“ç¤ºæ„å›¾</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        å”ä»£å¼€å§‹å‡ºç°ä»¥èŒ¶æ˜“é©¬çš„è´¸æ˜“å½¢å¼ï¼Œä¸»è¦å‘ç”Ÿåœ¨ä¸­åŸä¸åè•ƒã€å›çº¥ç­‰æ°‘æ—ä¹‹é—´ã€‚
                        è¿™ç§è´¸æ˜“ä¸ä»…æ»¡è¶³äº†ä¸­åŸå¯¹é©¬åŒ¹çš„éœ€æ±‚ï¼Œä¹Ÿä¸ºè¾¹ç–†æ°‘æ—æä¾›äº†é‡è¦é¥®å“ï¼Œä¿ƒè¿›äº†æ°‘æ—èåˆã€‚
                        èŒ¶å¶å¼€å§‹è¢«è§†ä¸ºæˆ˜ç•¥ç‰©èµ„ï¼Œä¸ºå®‹ä»£èŒ¶é©¬å¸çš„è®¾ç«‹å¥ å®šäº†åŸºç¡€ã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">èŒ¶é©¬è´¸æ˜“</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">æ°‘æ—èåˆ</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">æˆ˜ç•¥ç‰©èµ„</span>
                    </div>
                </div>
            </div>
            
            <!-- å®‹å…ƒæ—¶æœŸ -->
            <div class="timeline-item left" data-period="song" style="display: none;">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">å®‹ä»£ - èŒ¶å¶è´¸æ˜“åˆ¶åº¦åŒ–</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-secondary/20 to-accent/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">å®‹ä»£èŒ¶é©¬å¸ä¸æ¦·èŒ¶åˆ¶åº¦</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        å®‹ä»£è®¾ç«‹äº†ä¸“é—¨çš„èŒ¶é©¬å¸ï¼Œç®¡ç†èŒ¶å¶ä¸é©¬åŒ¹çš„è´¸æ˜“ï¼Œå½¢æˆäº†åˆ¶åº¦åŒ–çš„èŒ¶é©¬äº’å¸‚ã€‚
                        æ¦·èŒ¶åˆ¶åº¦ï¼ˆèŒ¶å¶ä¸“å–ï¼‰ä½¿èŒ¶å¶æˆä¸ºå›½å®¶è´¢æ”¿çš„é‡è¦æ¥æºã€‚
                        èŒ¶å¶é€šè¿‡ä¸ç»¸ä¹‹è·¯å¤§é‡è¾“å¾€è¥¿åŸŸï¼Œå¹¶å¼€å§‹ä¼ å…¥ä¸­äºšå’Œè¥¿äºšåœ°åŒºã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">èŒ¶é©¬å¸</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">æ¦·èŒ¶åˆ¶åº¦</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">è´¢æ”¿æ¥æº</span>
                    </div>
                </div>
            </div>
            
            <div class="timeline-item right" data-period="song" style="display: none;">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">å…ƒä»£ - èŒ¶å¶ä¼ æ’­åŠ é€Ÿ</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-primary/20 to-accent/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">å…ƒä»£ä¸œè¥¿æ–¹äº¤æµç¤ºæ„å›¾</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        è’™å¤å¸å›½æ‰“é€šäº†æ¬§äºšå¤§é™†ï¼Œä¸ºèŒ¶å¶ä¼ æ’­åˆ›é€ äº†æœ‰åˆ©æ¡ä»¶ã€‚
                        é©¬å¯Â·æ³¢ç½—ç­‰æ¬§æ´²æ—…è¡Œå®¶è®°å½•äº†ä¸­å›½çš„é¥®èŒ¶ä¹ ä¿—ï¼Œä½¿æ¬§æ´²äººå¯¹èŒ¶å¶æœ‰äº†åˆæ­¥è®¤è¯†ã€‚
                        ç –èŒ¶æŠ€æœ¯è¿›ä¸€æ­¥å‘å±•ï¼Œæ›´é€‚åˆé•¿é€”è¿è¾“ï¼Œæˆä¸ºè‰åŸæ°‘æ—çš„é‡è¦å•†å“ã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">ä¸œè¥¿äº¤æµ</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">ç –èŒ¶æŠ€æœ¯</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">é©¬å¯Â·æ³¢ç½—</span>
                    </div>
                </div>
            </div>
            
            <!-- æ˜ä»£æ—¶æœŸ -->
            <div class="timeline-item left" data-period="ming" style="display: none;">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">æ˜ä»£ - èŒ¶å¶è´¸æ˜“ç¹è£</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-accent/20 to-secondary/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">æ˜ä»£ä¸‡é‡ŒèŒ¶è·¯ç¤ºæ„å›¾</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        æ˜ä»£å½¢æˆäº†ä»¥å±±è¥¿å•†äººä¸ºä»£è¡¨çš„èŒ¶å•†é›†å›¢ï¼Œå¼€è¾Ÿäº†è‘—åçš„"ä¸‡é‡ŒèŒ¶è·¯"ã€‚
                        èŒ¶å¶æˆä¸ºä¸­è¥¿è´¸æ˜“çš„é‡è¦å•†å“ï¼Œé€šè¿‡é™†è·¯å’Œæµ·è·¯ä¸¤æ¡è·¯çº¿è¾“å¾€ä¸–ç•Œå„åœ°ã€‚
                        çº¢èŒ¶åˆ¶ä½œå·¥è‰ºæˆç†Ÿï¼Œæ›´é€‚åˆæ¬§æ´²äººå£å‘³ï¼Œä¸ºèŒ¶å¶å…¨çƒåŒ–å¥ å®šäº†åŸºç¡€ã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">ä¸‡é‡ŒèŒ¶è·¯</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">æ™‹å•†</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">çº¢èŒ¶å·¥è‰º</span>
                    </div>
                </div>
            </div>
            
            <!-- æ¸…ä»£æ—¶æœŸ -->
            <div class="timeline-item right" data-period="qing" style="display: none;">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">æ¸…ä»£ - èŒ¶å¶è´¸æ˜“é¼ç››</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-secondary/20 to-primary/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">æ¸…ä»£èŒ¶å¶è´¸æ˜“é¼ç››å›¾</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        æ¸…ä»£èŒ¶å¶è´¸æ˜“è¾¾åˆ°é¼ç››ï¼Œä¸­å›½æˆä¸ºä¸–ç•Œæœ€å¤§çš„èŒ¶å¶å‡ºå£å›½ã€‚
                        ä¸­ä¿„èŒ¶å¶è´¸æ˜“é€šè¿‡æ°å…‹å›¾å£å²¸ç¹è£å‘å±•ï¼Œå½¢æˆäº†ä¸“é—¨çš„èŒ¶å¶è´¸æ˜“è·¯çº¿ã€‚
                        ä½†é¸¦ç‰‡æˆ˜äº‰åï¼ŒèŒ¶å¶ç§æ¤æŠ€æœ¯å¤–æµï¼Œä¸­å›½é€æ¸å¤±å»èŒ¶å¶è´¸æ˜“å„æ–­åœ°ä½ã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">è´¸æ˜“é¼ç››</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">ä¸­ä¿„è´¸æ˜“</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">æŠ€æœ¯å¤–æµ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // çœŸå®åœ°å›¾å’Œæ ‡è®°ç‚¹
        let map;
        let currentMarkers = [];
        let currentPolylines = [];
        
        // åŸå¸‚åœ°ç†åæ ‡æ•°æ®
        const cityCoordinates = {
            'fujian': [26.4837, 117.9249], // ç¦å»ºæ­¦å¤·å±±
            'anxi': [25.0561, 118.1689], // å®‰æºª
            'chang-an': [34.3416, 108.9398], // è¥¿å®‰
            'chengdu': [30.5728, 104.0668], // æˆéƒ½
            'dali': [25.6065, 100.2676], // å¤§ç†
            'lhasa': [29.6469, 91.1409], // æ‹‰è¨
            'dunhuang': [40.1424, 94.6624], // æ•¦ç…Œ
            'kashi': [39.4704, 75.9896], // å–€ä»€
            'samarkand': [39.6270, 66.9750], // æ’’é©¬å°”ç½•
            'tehran': [35.6892, 51.3890], // å¾·é»‘å…°
            'istanbul': [41.0082, 28.9784], // ä¼Šæ–¯å¦å¸ƒå°”
            'moscow': [55.7558, 37.6173], // è«æ–¯ç§‘
            'kyakhta': [50.3464, 106.4475] // æ°å…‹å›¾
        };
        
        // æœä»£è·¯çº¿æ•°æ®
        const dynastyRoutes = {
            tang: {
                cities: ['fujian', 'chang-an', 'chengdu', 'dali', 'lhasa', 'dunhuang', 'kashi'],
                routes: [
                    ['fujian', 'chang-an', 'dunhuang', 'kashi'],
                    ['chengdu', 'dali', 'lhasa']
                ],
                policies: {
                    'fujian': ['æ­¦å¤·å²©èŒ¶äº§åœ°', 'å”ä»£è´¡èŒ¶'],
                    'chang-an': ['èŒ¶å¶æ¶ˆè´¹ä¸­å¿ƒ', 'èŒ¶æ–‡åŒ–å½¢æˆ'],
                    'lhasa': ['èŒ¶é©¬è´¸æ˜“', 'è—èŒ¶æ–‡åŒ–']
                }
            },
            song: {
                cities: ['fujian', 'anxi', 'chang-an', 'chengdu', 'dali', 'lhasa', 'dunhuang', 'kashi', 'samarkand'],
                routes: [
                    ['fujian', 'chang-an', 'dunhuang', 'kashi', 'samarkand'],
                    ['anxi', 'chang-an', 'dunhuang', 'kashi'],
                    ['chengdu', 'dali', 'lhasa']
                ],
                policies: {
                    'fujian': ['åŒ—è‹‘è´¡èŒ¶', 'å»ºçª‘é»‘ç›'],
                    'anxi': ['é“è§‚éŸ³å‘æºåœ°'],
                    'chang-an': ['èŒ¶é©¬å¸è®¾ç«‹', 'æ¦·èŒ¶åˆ¶åº¦']
                }
            },
            ming: {
                cities: ['fujian', 'anxi', 'chang-an', 'chengdu', 'dali', 'lhasa', 'dunhuang', 'kashi', 'samarkand', 'tehran'],
                routes: [
                    ['fujian', 'chang-an', 'dunhuang', 'kashi', 'samarkand', 'tehran'],
                    ['anxi', 'chang-an', 'dunhuang', 'kashi'],
                    ['chengdu', 'dali', 'lhasa']
                ],
                policies: {
                    'fujian': ['çº¢èŒ¶èµ·æº', 'æ­£å±±å°ç§'],
                    'chang-an': ['æ™‹å•†èŒ¶è·¯', 'ä¸‡é‡ŒèŒ¶é“'],
                    'samarkand': ['ä¸­äºšèŒ¶å¶é›†æ•£åœ°']
                }
            },
            qing: {
                cities: ['fujian', 'anxi', 'chang-an', 'chengdu', 'dali', 'lhasa', 'dunhuang', 'kashi', 'samarkand', 'tehran', 'istanbul', 'moscow', 'kyakhta'],
                routes: [
                    ['fujian', 'chang-an', 'dunhuang', 'kashi', 'samarkand', 'tehran', 'istanbul'],
                    ['fujian', 'chang-an', 'kyakhta', 'moscow'],
                    ['chengdu', 'dali', 'lhasa']
                ],
                policies: {
                    'fujian': ['èŒ¶å¶å‡ºå£åŸºåœ°', 'æ­¦å¤·çº¢èŒ¶'],
                    'kyakhta': ['ä¸­ä¿„èŒ¶å¶è´¸æ˜“', 'æ°å…‹å›¾å£å²¸'],
                    'moscow': ['æ¬§æ´²èŒ¶å¶æ¶ˆè´¹ä¸­å¿ƒ']
                }
            }
        };
        
        // åŸå¸‚ä¿¡æ¯æ•°æ®
        const cityData = {
            'fujian': {
                name: 'ç¦å»ºæ­¦å¤·å±±',
                description: 'ä¸­å›½è‘—åçš„èŒ¶å¶äº§åŒºï¼Œæ­¦å¤·å²©èŒ¶å’Œæ­£å±±å°ç§çº¢èŒ¶çš„åŸäº§åœ°ã€‚è‡ªå”ä»£ä»¥æ¥å°±æ˜¯è´¡èŒ¶äº§åŒºï¼Œé€šè¿‡ä¸ç»¸ä¹‹è·¯å°†èŒ¶å¶ä¼ æ’­åˆ°ä¸–ç•Œå„åœ°ã€‚',
                importance: 'èŒ¶å¶åŸäº§åœ°ã€è´¡èŒ¶äº§åŒºã€çº¢èŒ¶å‘æºåœ°',
                period: 'å”ä»£è‡³ä»Š'
            },
            'anxi': {
                name: 'ç¦å»ºå®‰æºª',
                description: 'ä¸­å›½ä¹Œé¾™èŒ¶ä¹‹ä¹¡ï¼Œé“è§‚éŸ³çš„å‘æºåœ°ã€‚å®‹ä»£å¼€å§‹èŒ¶å¶ç”Ÿäº§ï¼Œæ˜æ¸…æ—¶æœŸæˆä¸ºé‡è¦çš„èŒ¶å¶å‡ºå£åŸºåœ°ã€‚',
                importance: 'ä¹Œé¾™èŒ¶äº§åŒºã€é“è§‚éŸ³å‘æºåœ°',
                period: 'å®‹ä»£è‡³ä»Š'
            },
            'chang-an': {
                name: 'é•¿å®‰ï¼ˆä»Šè¥¿å®‰ï¼‰',
                description: 'ä¸ç»¸ä¹‹è·¯èµ·ç‚¹ï¼Œå”ä»£èŒ¶å¶æ¶ˆè´¹å’Œæ–‡åŒ–ä¸­å¿ƒã€‚é™†ç¾½åœ¨æ­¤æ’°å†™ã€ŠèŒ¶ç»ã€‹ï¼ŒèŒ¶æ–‡åŒ–åœ¨æ­¤å½¢æˆå¹¶ä¼ æ’­ã€‚',
                importance: 'èŒ¶æ–‡åŒ–ä¸­å¿ƒã€èŒ¶å¶è´¸æ˜“æ¢çº½',
                period: 'å”ä»£æœ€ä¸ºç¹è£'
            },
            'chengdu': {
                name: 'æˆéƒ½',
                description: 'è¥¿å—åœ°åŒºèŒ¶å¶é›†æ•£ä¸­å¿ƒï¼ŒèŒ¶é©¬å¤é“çš„é‡è¦èµ·ç‚¹ã€‚å®‹ä»£è®¾ç«‹èŒ¶é©¬å¸ï¼Œç®¡ç†èŒ¶å¶ä¸è—åŒºçš„é©¬åŒ¹è´¸æ˜“ã€‚',
                importance: 'èŒ¶é©¬è´¸æ˜“ä¸­å¿ƒã€è¥¿å—èŒ¶å¶é›†æ•£åœ°',
                period: 'å”å®‹æ—¶æœŸæœ€ä¸ºé‡è¦'
            },
            'dali': {
                name: 'å¤§ç†',
                description: 'èŒ¶é©¬å¤é“ä¸Šçš„é‡è¦èŠ‚ç‚¹ï¼Œè¿æ¥äº‘å—ä¸è¥¿è—çš„è´¸æ˜“æ¢çº½ã€‚æ™®æ´±èŒ¶ç­‰äº‘å—èŒ¶å¶é€šè¿‡æ­¤åœ°è¿å¾€è—åŒºã€‚',
                importance: 'èŒ¶é©¬å¤é“æ¢çº½ã€æ°‘æ—è´¸æ˜“ä¸­å¿ƒ',
                period: 'å”å®‹è‡³æ˜æ¸…'
            },
            'lhasa': {
                name: 'æ‹‰è¨',
                description: 'è¥¿è—æ”¿æ²»ç»æµä¸­å¿ƒï¼ŒèŒ¶å¶æ¶ˆè´¹çš„é‡è¦å¸‚åœºã€‚è—æ°‘"å®å¯ä¸‰æ—¥æ— ç²®ï¼Œä¸å¯ä¸€æ—¥æ— èŒ¶"ï¼Œå½¢æˆäº†ç‹¬ç‰¹çš„é…¥æ²¹èŒ¶æ–‡åŒ–ã€‚',
                importance: 'èŒ¶å¶æ¶ˆè´¹å¸‚åœºã€è—èŒ¶æ–‡åŒ–ä¸­å¿ƒ',
                period: 'å”å®‹è‡³ä»Š'
            },
            'dunhuang': {
                name: 'æ•¦ç…Œ',
                description: 'ä¸ç»¸ä¹‹è·¯ä¸Šçš„é‡è¦å…³å£ï¼ŒèŒ¶å¶å‘è¥¿ä¼ æ’­çš„å¿…ç»ä¹‹åœ°ã€‚è«é«˜çªŸå£ç”»ä¸­æœ‰é¥®èŒ¶åœºæ™¯çš„æç»˜ã€‚',
                importance: 'ä¸ç»¸ä¹‹è·¯å…³å£ã€æ–‡åŒ–äº¤æ±‡ç‚¹',
                period: 'æ±‰å”æ—¶æœŸ'
            },
            'kashi': {
                name: 'å–€ä»€',
                description: 'ä¸ç»¸ä¹‹è·¯ä¸Šçš„é‡è¦è´¸æ˜“åŸå¸‚ï¼ŒèŒ¶å¶å‘ä¸­äºšä¼ æ’­çš„å…³é”®èŠ‚ç‚¹ã€‚å½“åœ°å½¢æˆäº†ç‹¬ç‰¹çš„é¥®èŒ¶ä¹ ä¿—ã€‚',
                importance: 'ä¸­äºšè´¸æ˜“æ¢çº½ã€èŒ¶å¶ä¼ æ’­èŠ‚ç‚¹',
                period: 'å„ä¸ªå†å²æ—¶æœŸ'
            },
            'samarkand': {
                name: 'æ’’é©¬å°”ç½•',
                description: 'ä¸­äºšå¤åŸï¼Œä¸ç»¸ä¹‹è·¯ä¸Šçš„é‡è¦ä¸­è½¬ç«™ã€‚èŒ¶å¶åœ¨æ­¤é›†æ•£å¹¶ç»§ç»­å‘è¥¿ä¼ æ’­åˆ°æ³¢æ–¯å’Œé˜¿æ‹‰ä¼¯åœ°åŒºã€‚',
                importance: 'ä¸­äºšèŒ¶å¶é›†æ•£åœ°ã€æ–‡åŒ–äº¤æµä¸­å¿ƒ',
                period: 'å”å®‹è‡³å…ƒä»£'
            },
            'tehran': {
                name: 'å¾·é»‘å…°',
                description: 'æ³¢æ–¯åœ°åŒºçš„é‡è¦åŸå¸‚ï¼ŒèŒ¶å¶ä¼ æ’­åˆ°ä¸­ä¸œåœ°åŒºçš„å…³é”®èŠ‚ç‚¹ã€‚æ³¢æ–¯äººå‘å±•å‡ºäº†ç‹¬ç‰¹çš„èŒ¶æ–‡åŒ–ã€‚',
                importance: 'ä¸­ä¸œèŒ¶å¶é›†æ•£åœ°ã€æ³¢æ–¯èŒ¶æ–‡åŒ–',
                period: 'æ˜æ¸…æ—¶æœŸ'
            },
            'istanbul': {
                name: 'ä¼Šæ–¯å¦å¸ƒå°”',
                description: 'æ¬§äºšäº¤æ±‡ç‚¹ï¼ŒèŒ¶å¶ä¼ æ’­åˆ°æ¬§æ´²çš„é‡è¦é—¨æˆ·ã€‚åœŸè€³å…¶èŒ¶æ–‡åŒ–æ·±å—æ³¢æ–¯å’Œä¸­å›½å½±å“ã€‚',
                importance: 'æ¬§æ´²èŒ¶å¶é—¨æˆ·ã€ä¸œè¥¿æ–¹äº¤æ±‡ç‚¹',
                period: 'æ˜æ¸…æ—¶æœŸ'
            },
            'moscow': {
                name: 'è«æ–¯ç§‘',
                description: 'ä¿„ç½—æ–¯èŒ¶å¶æ¶ˆè´¹ä¸­å¿ƒï¼Œé€šè¿‡æ°å…‹å›¾è´¸æ˜“ä»ä¸­å›½è¿›å£å¤§é‡èŒ¶å¶ã€‚ä¿„ç½—æ–¯å½¢æˆäº†ç‹¬ç‰¹çš„èŒ¶ç‚Šæ–‡åŒ–ã€‚',
                importance: 'æ¬§æ´²èŒ¶å¶æ¶ˆè´¹ä¸­å¿ƒã€èŒ¶ç‚Šæ–‡åŒ–',
                period: 'æ¸…ä»£'
            },
            'kyakhta': {
                name: 'æ°å…‹å›¾',
                description: 'ä¸­ä¿„è¾¹å¢ƒè´¸æ˜“å£å²¸ï¼Œæ¸…ä»£èŒ¶å¶è´¸æ˜“çš„é‡è¦é€šé“ã€‚æ™‹å•†é€šè¿‡æ­¤åœ°å‘ä¿„ç½—æ–¯å‡ºå£å¤§é‡èŒ¶å¶ã€‚',
                importance: 'ä¸­ä¿„èŒ¶å¶è´¸æ˜“å£å²¸ã€æ™‹å•†è´¸æ˜“ç‚¹',
                period: 'æ¸…ä»£'
            }
        };
        
        let currentPeriod = 'tang';
        let currentDynasty = 'tang';
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeTimeline();
            initializeMap();
            showPeriod('tang');
            switchDynasty('tang');
        });
        
        // åˆå§‹åŒ–Leafletåœ°å›¾
        function initializeMap() {
            // åˆ›å»ºåœ°å›¾å®ä¾‹ï¼Œä¸­å¿ƒç‚¹è®¾åœ¨ä¸­å›½
            map = L.map('realMap').setView([35.0, 105.0], 4);
            
            // ä½¿ç”¨é«˜å¾·åœ°å›¾ç“¦ç‰‡
            L.tileLayer('https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}', {
                attribution: 'Â© é«˜å¾·åœ°å›¾',
                subdomains: ['1', '2', '3', '4'],
                maxZoom: 18
            }).addTo(map);
        }
        
        // åˆ‡æ¢æœä»£
        function switchDynasty(dynasty) {
            currentDynasty = dynasty;
            
            // æ¸…é™¤ç°æœ‰æ ‡è®°å’Œè·¯çº¿
            currentMarkers.forEach(marker => map.removeLayer(marker));
            currentPolylines.forEach(polyline => map.removeLayer(polyline));
            currentMarkers = [];
            currentPolylines = [];
            
            const dynastyData = dynastyRoutes[dynasty];
            
            // æ·»åŠ åŸå¸‚æ ‡è®°ç‚¹
            dynastyData.cities.forEach(cityId => {
                const coords = cityCoordinates[cityId];
                const cityInfo = cityData[cityId];
                const policies = dynastyData.policies[cityId] || [];
                
                if (coords && cityInfo) {
                    // åˆ›å»ºè‡ªå®šä¹‰å›¾æ ‡
                    const customIcon = L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="width: 20px; height: 20px; background: linear-gradient(135deg, #3A7D44, #8B4513); border: 3px solid #F5F5F0; border-radius: 50%; box-shadow: 0 4px 12px rgba(58, 125, 68, 0.5);"></div>`,
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    });
                    
                    // åˆ›å»ºå¼¹çª—å†…å®¹
                    const popupContent = `
                        <div class="popup-title">${cityInfo.name}</div>
                        <div class="popup-description">${cityInfo.description}</div>
                        <div style="margin: 8px 0;">
                            <strong>é‡è¦åœ°ä½ï¼š</strong>${cityInfo.importance}<br>
                            <strong>ç¹è£æ—¶æœŸï¼š</strong>${cityInfo.period}
                        </div>
                        ${policies.length > 0 ? `
                        <div style="margin-top: 12px;">
                            <strong>èŒ¶å¶ç›¸å…³ï¼š</strong>
                            <div class="popup-tags">
                                ${policies.map(policy => `<span class="popup-tag">${policy}</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                    `;
                    
                    const marker = L.marker(coords, { icon: customIcon })
                        .bindPopup(popupContent, {
                            maxWidth: 300,
                            className: 'custom-popup'
                        })
                        .addTo(map);
                    
                    marker.on('click', function() {
                        showCityInfo(cityId);
                    });
                    
                    currentMarkers.push(marker);
                }
            });
            
            // æ·»åŠ è·¯çº¿
            dynastyData.routes.forEach((route, index) => {
                const routeCoords = route.map(cityId => cityCoordinates[cityId]).filter(coord => coord);
                
                if (routeCoords.length > 1) {
                    const polyline = L.polyline(routeCoords, {
                        color: index === 0 ? '#3A7D44' : '#8B4513',
                        weight: 4,
                        opacity: 0.8,
                        dashArray: index === 0 ? null : '10, 5'
                    }).addTo(map);
                    
                    currentPolylines.push(polyline);
                }
            });
            
            // æ›´æ–°åœ°å›¾è§†å›¾ä»¥åŒ…å«æ‰€æœ‰æ ‡è®°ç‚¹
            if (currentMarkers.length > 0) {
                const group = new L.featureGroup(currentMarkers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }
        
        // æ—¶é—´è½´åŠ¨ç”»åˆå§‹åŒ–
        function initializeTimeline() {
            const timelineItems = document.querySelectorAll('.timeline-item');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        anime({
                            targets: entry.target,
                            opacity: [0, 1],
                            translateY: [50, 0],
                            duration: 800,
                            easing: 'easeOutExpo',
                            delay: 200
                        });
                    }
                });
            }, { threshold: 0.1 });
            
            timelineItems.forEach(item => observer.observe(item));
        }
        
        // æ˜¾ç¤ºç‰¹å®šæ—¶æœŸ
        function showPeriod(period) {
            currentPeriod = period;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.period === period) {
                    btn.classList.add('active');
                }
            });
            
            // æ˜¾ç¤º/éšè—æ—¶é—´è½´é¡¹ç›®
            document.querySelectorAll('.timeline-item').forEach(item => {
                if (item.dataset.period === period) {
                    item.style.display = 'block';
                    anime({
                        targets: item,
                        opacity: [0, 1],
                        translateY: [30, 0],
                        duration: 600,
                        easing: 'easeOutExpo'
                    });
                } else {
                    item.style.display = 'none';
                }
            });
            
            // æ›´æ–°åœ°å›¾
            updateMap(period);
        }
        
        // æ›´æ–°åœ°å›¾æ˜¾ç¤º
        function updateMap(period) {
            // åŒæ­¥æ›´æ–°çœŸå®åœ°å›¾
            switchDynasty(period);
            
            // åŒæ­¥ä¸‹æ‹‰é€‰æ‹©å™¨
            document.getElementById('dynastySelect').value = period;
        }
        
        // æ˜¾ç¤ºåŸå¸‚ä¿¡æ¯
        function showCityInfo(cityId) {
            const city = cityData[cityId];
            const infoCard = document.getElementById('cityInfo');
            
            if (city) {
                infoCard.innerHTML = `
                    <h4 class="text-2xl font-bold text-foreground mb-3">${city.name}</h4>
                    <p class="text-secondary leading-relaxed mb-4">${city.description}</p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="font-bold text-foreground mb-2">é‡è¦åœ°ä½</h5>
                            <p class="text-secondary text-sm">${city.importance}</p>
                        </div>
                        <div>
                            <h5 class="font-bold text-foreground mb-2">ç¹è£æ—¶æœŸ</h5>
                            <p class="text-secondary text-sm">${city.period}</p>
                        </div>
                    </div>
                `;
                
                infoCard.classList.add('show');
            }
        }
        
        // èšç„¦æ—¶é—´è½´é¡¹ç›®
        function focusTimelineItem(dot) {
            // ç§»é™¤å…¶ä»–æ´»è·ƒçŠ¶æ€
            document.querySelectorAll('.timeline-dot').forEach(d => {
                d.classList.remove('active');
            });
            
            // æ·»åŠ æ´»è·ƒçŠ¶æ€
            dot.classList.add('active');
            
            // æ»šåŠ¨åˆ°è¯¥é¡¹ç›®
            dot.parentElement.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
            
            // æ·»åŠ è„‰å†²åŠ¨ç”»
            anime({
                targets: dot,
                scale: [1.3, 1.5, 1.3],
                duration: 800,
                easing: 'easeOutElastic(1, .8)'
            });
        }
        
        // å“åº”å¼å¤„ç†
        function handleResize() {
            if (window.innerWidth <= 768) {
                // ç§»åŠ¨ç«¯é€‚é…
                document.querySelectorAll('.timeline-item').forEach(item => {
                    item.classList.remove('left', 'right');
                    item.classList.add('left');
                });
            }
        }
        
        window.addEventListener('resize', handleResize);
        handleResize(); // åˆå§‹åŒ–æ—¶è°ƒç”¨
        
        // é¡µé¢åŠ è½½åŠ¨ç”»
        anime.timeline({
            easing: 'easeOutExpo',
            duration: 750
        })
        .add({
            targets: 'h1',
            opacity: [0, 1],
            translateY: [50, 0]
        })
        .add({
            targets: '.control-panel',
            opacity: [0, 1],
            translateY: [30, 0]
        }, '-=500')
        .add({
            targets: '.map-container',
            opacity: [0, 1],
            scale: [0.9, 1]
        }, '-=300');
    </script>
</body>
</html>
