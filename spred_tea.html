<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ç»¸ä¹‹è·¯å†å²æ—¶é—´è½´ä¸äº¤äº’åœ°å›¾</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- åŠ¨ç”»åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    
    <!-- Leaflet.js åœ°å›¾åº“ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Tailwind é…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#D4AF37',
                        secondary: '#8B4513',
                        accent: '#FF6B35',
                        background: '#FDF5E6',
                        foreground: '#2F1B14'
                    }
                }
            }
        }
    </script>
    
    <style>
        /* ä¸ç»¸é•¿å·é£æ ¼èƒŒæ™¯ */
        body {
            background: linear-gradient(135deg, #FDF5E6 0%, #F5E6D3 100%);
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 69, 19, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 107, 53, 0.1) 0%, transparent 50%);
            min-height: 100vh;
            font-family: 'serif', 'å®‹ä½“', 'SimSun', serif;
        }
        
        /* ä¸ç»¸çº¹ç†æ•ˆæœ */
        .silk-texture {
            background: linear-gradient(45deg, 
                rgba(212, 175, 55, 0.1) 25%, 
                transparent 25%, 
                transparent 75%, 
                rgba(212, 175, 55, 0.1) 75%),
                linear-gradient(-45deg, 
                rgba(212, 175, 55, 0.1) 25%, 
                transparent 25%, 
                transparent 75%, 
                rgba(212, 175, 55, 0.1) 75%);
            background-size: 20px 20px;
        }
        
        /* æ—¶é—´è½´æ ·å¼ */
        .timeline-container {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #D4AF37, #8B4513);
            transform: translateX(-50%);
            border-radius: 2px;
        }
        
        .timeline-item {
            position: relative;
            margin: 60px 0;
            opacity: 0;
            transform: translateY(50px);
        }
        
        .timeline-item.left {
            text-align: right;
            padding-right: calc(50% + 40px);
        }
        
        .timeline-item.right {
            text-align: left;
            padding-left: calc(50% + 40px);
        }
        
        .timeline-dot {
            position: absolute;
            left: 50%;
            top: 20px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #D4AF37, #FF6B35);
            border-radius: 50%;
            transform: translateX(-50%);
            border: 4px solid #FDF5E6;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .timeline-dot:hover {
            transform: translateX(-50%) scale(1.2);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.8);
        }
        
        .timeline-dot.active {
            background: linear-gradient(135deg, #FF6B35, #D4AF37);
            transform: translateX(-50%) scale(1.3);
            box-shadow: 0 0 40px rgba(255, 107, 53, 0.8);
        }
        
        .timeline-content {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(212, 175, 55, 0.3);
            transition: all 0.3s ease;
        }
        
        .timeline-content:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: rgba(212, 175, 55, 0.6);
        }
        
        /* åœ°å›¾å®¹å™¨æ ·å¼ */
        .map-container {
            position: relative;
            background: linear-gradient(135deg, #2C1810 0%, #4A2C1A 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 40px 0;
            overflow: hidden;
        }
        
        .map-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 107, 53, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        /* Leafletåœ°å›¾æ ·å¼ */
        #realMap {
            width: 100%;
            height: 600px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(212, 175, 55, 0.3);
        }
        
        /* æœä»£é€‰æ‹©å™¨æ ·å¼ */
        .dynasty-selector {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(212, 175, 55, 0.3);
        }
        
        .dynasty-selector select {
            background: linear-gradient(135deg, #D4AF37, #FF6B35);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            outline: none;
        }
        
        /* è‡ªå®šä¹‰æ ‡è®°ç‚¹æ ·å¼ */
        .custom-marker {
            background: linear-gradient(135deg, #D4AF37, #FF6B35);
            border: 3px solid #FDF5E6;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.5);
            transition: all 0.3s ease;
        }
        
        .custom-marker:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.8);
        }
        
        /* å¼¹çª—æ ·å¼ */
        .leaflet-popup-content-wrapper {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }
        
        .leaflet-popup-content {
            margin: 16px;
            font-family: 'serif', 'å®‹ä½“', 'SimSun', serif;
        }
        
        .popup-title {
            font-size: 18px;
            font-weight: bold;
            color: #2F1B14;
            margin-bottom: 8px;
        }
        
        .popup-description {
            color: #8B4513;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        .popup-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .popup-tag {
            background: linear-gradient(135deg, #D4AF37, #FF6B35);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* æ§åˆ¶é¢æ¿æ ·å¼ */
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(212, 175, 55, 0.3);
        }
        
        .period-btn {
            background: linear-gradient(135deg, #D4AF37, #FF6B35);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 4px;
        }
        
        .period-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }
        
        .period-btn.active {
            background: linear-gradient(135deg, #FF6B35, #D4AF37);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.5);
        }
        
        /* ä¿¡æ¯å¡ç‰‡æ ·å¼ */
        .info-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #D4AF37;
            opacity: 0;
            transform: translateX(-20px);
        }
        
        .info-card.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .timeline-item.left,
            .timeline-item.right {
                text-align: left;
                padding-left: 60px;
                padding-right: 20px;
            }
            
            .timeline-line {
                left: 30px;
            }
            
            .timeline-dot {
                left: 30px;
            }
            
            .control-panel {
                padding: 16px;
            }
            
            .period-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
        
        /* éŸ³é¢‘æ§åˆ¶æ ·å¼ */
        .audio-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(212, 175, 55, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 12px 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .audio-control:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* çŸ¥è¯†é—®ç­”æ ·å¼ */
        .quiz-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin: 40px 0;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
            border: 3px solid rgba(212, 175, 55, 0.3);
        }
        
        .quiz-question {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border-left: 4px solid #D4AF37;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .quiz-option {
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quiz-option:hover {
            background: rgba(212, 175, 55, 0.1);
            border-color: #D4AF37;
        }
        
        .quiz-option.selected {
            background: rgba(212, 175, 55, 0.2);
            border-color: #D4AF37;
        }
        
        .quiz-option.correct {
            background: rgba(34, 197, 94, 0.2);
            border-color: #16a34a;
        }
        
        .quiz-option.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border-color: #dc2626;
        }
        
        .quiz-submit {
            background: linear-gradient(135deg, #D4AF37, #FF6B35);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        .quiz-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }
        
        .quiz-feedback {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            background: rgba(212, 175, 55, 0.1);
            border-left: 4px solid #D4AF37;
        }
        
        .quiz-feedback.correct {
            background: rgba(34, 197, 94, 0.1);
            border-left-color: #16a34a;
        }
        
        .quiz-feedback.incorrect {
            background: rgba(239, 68, 68, 0.1);
            border-left-color: #dc2626;
        }
    </style>
</head>
<body>
    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="narratorAudio" preload="auto">
        <!-- éŸ³é¢‘æ–‡ä»¶é“¾æ¥ - è¿™é‡Œä½¿ç”¨å ä½ç¬¦ï¼Œå®é™…ä½¿ç”¨æ—¶è¯·æ›¿æ¢ä¸ºçœŸå®é“¾æ¥ -->
        <source src="#" type="audio/mpeg">
    </audio>
    
    <!-- éŸ³é¢‘æ§åˆ¶æŒ‰é’® -->
    <div class="audio-control" onclick="toggleAudio()">
        <span id="audioIcon">ğŸ”Š</span>
        <span class="text-white font-bold ml-2">å†å²è§£è¯´</span>
    </div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container mx-auto px-4 py-8">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <header class="text-center mb-12">
            <h1 class="text-5xl font-bold text-foreground mb-4 silk-texture">
                ä¸ç»¸ä¹‹è·¯å†å²æ—¶é—´è½´
            </h1>
            <p class="text-xl text-secondary max-w-3xl mx-auto leading-relaxed">
                ç©¿è¶Šæ—¶ç©ºï¼Œæ¢ç´¢è¿™æ¡è¿æ¥ä¸œè¥¿æ–¹æ–‡æ˜çš„å¤ä»£è´¸æ˜“é€šé“ï¼Œè§è¯ä¸­åæ–‡æ˜ä¸ä¸–ç•Œçš„äº¤æµèåˆ
            </p>
        </header>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel mb-8">
            <h3 class="text-2xl font-bold text-foreground mb-4">é€‰æ‹©å†å²æ—¶æœŸ</h3>
            <div class="flex flex-wrap justify-center">
                <button class="period-btn active" onclick="showPeriod('han')" data-period="han">
                    æ±‰ä»£å¼€æ‹“æœŸ (å‰138-220å¹´)
                </button>
                <button class="period-btn" onclick="showPeriod('tang')" data-period="tang">
                    å”ä»£é¼ç››æœŸ (618-907å¹´)
                </button>
                <button class="period-btn" onclick="showPeriod('song')" data-period="song">
                    å®‹å…ƒç¹è£æœŸ (960-1368å¹´)
                </button>
                <button class="period-btn" onclick="showPeriod('ming')" data-period="ming">
                    æ˜æ¸…è¡°è½æœŸ (1368-1912å¹´)
                </button>
            </div>
        </div>
        
        <!-- äº¤äº’åœ°å›¾ -->
        <div class="map-container">
            <h3 class="text-3xl font-bold text-primary mb-6 text-center">ä¸ç»¸ä¹‹è·¯äº¤äº’åœ°å›¾</h3>
            
            <!-- æœä»£é€‰æ‹©å™¨ -->
            <div class="dynasty-selector">
                <label class="text-foreground font-bold mr-4">é€‰æ‹©æœä»£ï¼š</label>
                <select id="dynastySelect" onchange="switchDynasty(this.value)">
                    <option value="han">æ±‰ä»£ (å‰206-220å¹´)</option>
                    <option value="tang">å”ä»£ (618-907å¹´)</option>
                    <option value="song">å®‹å…ƒ (960-1368å¹´)</option>
                    <option value="ming">æ˜æ¸… (1368-1912å¹´)</option>
                </select>
            </div>
            
            <!-- LeafletçœŸå®åœ°å›¾ -->
            <div id="realMap"></div>
            
            <!-- åœ°å›¾è¯´æ˜ -->
            <div class="mt-6 text-center">
                <p class="text-primary font-bold">ç‚¹å‡»åœ°å›¾æ ‡è®°ç‚¹æŸ¥çœ‹åŸå¸‚è¯¦ç»†ä¿¡æ¯ | åˆ‡æ¢æœä»£æŸ¥çœ‹ä¸åŒæ—¶æœŸçš„ä¸ç»¸ä¹‹è·¯å‘å±•çŠ¶æ€</p>
            </div>
        </div>
        
        <!-- åŸå¸‚ä¿¡æ¯å¡ç‰‡ -->
        <div id="cityInfo" class="info-card">
            <h4 class="text-2xl font-bold text-foreground mb-3">é€‰æ‹©åŸå¸‚æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</h4>
            <p class="text-secondary">ç‚¹å‡»åœ°å›¾ä¸Šçš„åŸå¸‚èŠ‚ç‚¹ï¼Œäº†è§£è¯¥åŸå¸‚åœ¨ä¸ç»¸ä¹‹è·¯ä¸Šçš„é‡è¦ä½œç”¨å’Œå†å²æ•…äº‹ã€‚</p>
        </div>
        
        <!-- æ—¶é—´è½´ -->
        <div class="timeline-container mt-16">
            <div class="timeline-line"></div>
            
            <!-- æ±‰ä»£æ—¶æœŸ -->
            <div class="timeline-item left" data-period="han">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">å‰138å¹´ - å¼ éªå‡ºä½¿è¥¿åŸŸ</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">é•¿å®‰å¤åŸé—¨ç¤ºæ„å›¾</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        æ±‰æ­¦å¸æ´¾é£å¼ éªå‡ºä½¿è¥¿åŸŸï¼Œå¼€å¯äº†ä¸­åŸä¸è¥¿åŸŸçš„æ­£å¼å¤–äº¤å’Œè´¸æ˜“å¾€æ¥ã€‚å¼ éªå†ç»è‰°é™©ï¼Œ
                        ä¸¤æ¬¡å‡ºä½¿è¥¿åŸŸï¼Œä¸ä»…å¸¦å›äº†å…³äºè¥¿åŸŸå„å›½çš„è¯¦ç»†æƒ…æŠ¥ï¼Œæ›´é‡è¦çš„æ˜¯å¼€è¾Ÿäº†åæ¥è¢«ç§°ä¸º"ä¸ç»¸ä¹‹è·¯"çš„è´¸æ˜“é€šé“ã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">æ”¿æ²»å¤–äº¤</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">è´¸æ˜“å¼€æ‹“</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">æ–‡åŒ–äº¤æµ</span>
                    </div>
                </div>
            </div>
            
            <div class="timeline-item right" data-period="han">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">å‰60å¹´ - è¥¿åŸŸéƒ½æŠ¤åºœè®¾ç«‹</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-accent/20 to-primary/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">ä¸ç»¸ä¹‹è·¯å•†é˜Ÿç¤ºæ„å›¾</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        æ±‰æœåœ¨è¥¿åŸŸè®¾ç«‹éƒ½æŠ¤åºœï¼Œæ ‡å¿—ç€ä¸ç»¸ä¹‹è·¯è´¸æ˜“çš„åˆ¶åº¦åŒ–å’Œè§„èŒƒåŒ–ã€‚éƒ½æŠ¤åºœä¸ä»…è´Ÿè´£å†›äº‹é˜²åŠ¡ï¼Œ
                        æ›´é‡è¦çš„æ˜¯ä¿æŠ¤å•†é˜Ÿå®‰å…¨ï¼Œç»´æŠ¤è´¸æ˜“ç§©åºï¼Œä½¿å¾—ä¸ç»¸ä¹‹è·¯æˆä¸ºçœŸæ­£æ„ä¹‰ä¸Šçš„å›½é™…è´¸æ˜“å¤§åŠ¨è„‰ã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">åˆ¶åº¦å»ºè®¾</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">è´¸æ˜“ä¿æŠ¤</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">å†›äº‹ç®¡ç†</span>
                    </div>
                </div>
            </div>
            
            <!-- å”ä»£æ—¶æœŸ -->
            <div class="timeline-item left" data-period="tang" style="display: none;">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">618-907å¹´ - å”ä»£ä¸è·¯é¼ç››</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-secondary/20 to-accent/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">ä¸ç»¸ç»‡ç‰©çº¹æ ·ç¤ºæ„å›¾</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        å”æœæ˜¯ä¸ç»¸ä¹‹è·¯çš„é»„é‡‘æ—¶ä»£ï¼Œå›½åŠ›å¼ºç››ï¼Œå¯¹å¤–å¼€æ”¾ç¨‹åº¦æé«˜ã€‚é•¿å®‰æˆä¸ºä¸–ç•Œæ€§çš„å›½é™…å¤§éƒ½å¸‚ï¼Œ
                        å„å›½å•†äººã€ä½¿èŠ‚ã€å­¦è€…äº‘é›†ã€‚ä¸ç»¸ã€ç“·å™¨ã€èŒ¶å¶ç­‰ä¸­å›½å•†å“è¿œé”€æ¬§æ´²ï¼ŒåŒæ—¶å¼•è¿›äº†èƒ¡æ¤’ã€å®çŸ³ç­‰çè´µç‰©å“ã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">æ–‡åŒ–ç¹è£</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">è´¸æ˜“é¼ç››</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">å›½é™…äº¤æµ</span>
                    </div>
                </div>
            </div>
            
            <div class="timeline-item right" data-period="tang" style="display: none;">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">ç„å¥˜è¥¿è¡Œå–ç»</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-primary/20 to-accent/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">æ’’é©¬å°”ç½•å¤åŸç¤ºæ„å›¾</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        å”ä»£é«˜åƒ§ç„å¥˜æ²¿ä¸ç»¸ä¹‹è·¯è¥¿è¡Œæ±‚æ³•ï¼Œå†æ—¶17å¹´ï¼Œè¡Œç¨‹5ä¸‡é‡Œï¼Œä¸ä»…å¸¦å›äº†å¤§é‡ä½›ç»ï¼Œ
                        æ›´é‡è¦çš„æ˜¯ä¿ƒè¿›äº†ä¸­å°æ–‡åŒ–äº¤æµï¼Œå…¶ã€Šå¤§å”è¥¿åŸŸè®°ã€‹æˆä¸ºç ”ç©¶å¤ä»£ä¸­äºšã€å—äºšå†å²åœ°ç†çš„çè´µèµ„æ–™ã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">å®—æ•™ä¼ æ’­</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">æ–‡åŒ–äº¤æµ</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">å­¦æœ¯ç ”ç©¶</span>
                    </div>
                </div>
            </div>
            
            <!-- å®‹å…ƒæ—¶æœŸ -->
            <div class="timeline-item left" data-period="song" style="display: none;">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">960-1368å¹´ - æµ·é™†å¹¶è¿›</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-accent/20 to-secondary/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">å›å£«å¦ä¸å ¡å¤åŸç¤ºæ„å›¾</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        å®‹ä»£æµ·ä¸Šä¸ç»¸ä¹‹è·¯å…´èµ·ï¼Œä¸é™†ä¸Šä¸ç»¸ä¹‹è·¯å½¢æˆæµ·é™†å¹¶è¿›çš„æ ¼å±€ã€‚å…ƒæœç»Ÿä¸€åï¼Œ
                        ä¸ç»¸ä¹‹è·¯è¾¾åˆ°æ–°çš„ç¹è£æœŸï¼Œé©¬å¯Â·æ³¢ç½—ç­‰æ¬§æ´²å•†äººæ²¿æ­¤è·¯æ¥åˆ°ä¸­å›½ï¼Œä¿ƒè¿›äº†ä¸œè¥¿æ–¹çš„æ·±åº¦äº¤æµã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">æµ·ä¸Šè´¸æ˜“</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">æŠ€æœ¯ä¼ æ’­</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">å•†ä¸šç¹è£</span>
                    </div>
                </div>
            </div>
            
            <!-- æ˜æ¸…æ—¶æœŸ -->
            <div class="timeline-item right" data-period="ming" style="display: none;">
                <div class="timeline-dot" onclick="focusTimelineItem(this)"></div>
                <div class="timeline-content">
                    <h3 class="text-2xl font-bold text-foreground mb-3">1368-1912å¹´ - é€æ¸è¡°è½</h3>
                    <div class="w-full h-48 bg-gradient-to-br from-secondary/20 to-primary/20 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-foreground/60 text-lg">ä¸ç»¸é•¿å·èƒŒæ™¯ç¤ºæ„å›¾</span>
                    </div>
                    <p class="text-secondary leading-relaxed">
                        æ˜æ¸…æ—¶æœŸï¼Œç”±äºæµ·ä¸Šè´¸æ˜“çš„å…´èµ·å’Œæ”¿æ²»å› ç´ çš„å½±å“ï¼Œä¼ ç»Ÿçš„é™†ä¸Šä¸ç»¸ä¹‹è·¯é€æ¸è¡°è½ã€‚
                        ä½†å…¶å†å²æ„ä¹‰å’Œæ–‡åŒ–ä»·å€¼æ°¸è¿œä¸ä¼šæ¶ˆå¤±ï¼Œä¸ºä»Šå¤©çš„"ä¸€å¸¦ä¸€è·¯"å€¡è®®æä¾›äº†æ·±åšçš„å†å²åº•è•´ã€‚
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-primary text-white px-3 py-1 rounded-full text-sm">å†å²ä¼ æ‰¿</span>
                        <span class="bg-accent text-white px-3 py-1 rounded-full text-sm">æ–‡åŒ–é—äº§</span>
                        <span class="bg-secondary text-white px-3 py-1 rounded-full text-sm">ç°ä»£å¯ç¤º</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- çŸ¥è¯†é—®ç­”åŒºåŸŸ -->
        <div class="quiz-section">
            <h3 class="text-3xl font-bold text-foreground mb-6 text-center">ä¸ç»¸ä¹‹è·¯çŸ¥è¯†é—®ç­”</h3>
            <p class="text-secondary text-center mb-8">é€šè¿‡é—®ç­”åŠ æ·±å¯¹ä¸ç»¸ä¹‹è·¯å†å²çš„ç†è§£</p>
            
            <!-- å•é€‰é¢˜ -->
            <div class="quiz-question">
                <h4 class="text-xl font-bold text-foreground mb-4">å¼ éªå‡ºä½¿è¥¿åŸŸå¼€è¾Ÿä¸ç»¸ä¹‹è·¯æ˜¯åœ¨å“ªä¸ªæœä»£ï¼Ÿ</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectOption(this, 0)">ç§¦æœ</div>
                    <div class="quiz-option" onclick="selectOption(this, 1)">æ±‰æœ</div>
                    <div class="quiz-option" onclick="selectOption(this, 2)">å”æœ</div>
                    <div class="quiz-option" onclick="selectOption(this, 3)">å®‹æœ</div>
                </div>
                <button class="quiz-submit" onclick="checkAnswer(0, [1])">æäº¤ç­”æ¡ˆ</button>
                <div class="quiz-feedback" id="feedback-0" style="display: none;">
                    <p><strong>è§£æï¼š</strong>å¼ éªå‡ºä½¿è¥¿åŸŸå‘ç”Ÿåœ¨æ±‰æ­¦å¸æ—¶æœŸï¼ˆå‰138å¹´ï¼‰ï¼Œè¿™æ ‡å¿—ç€ä¸ç»¸ä¹‹è·¯çš„æ­£å¼å¼€è¾Ÿã€‚</p>
                </div>
            </div>
            
            <!-- å¤šé€‰é¢˜ -->
            <div class="quiz-question">
                <h4 class="text-xl font-bold text-foreground mb-4">ä¸ç»¸ä¹‹è·¯ä¸Šçš„ä¸»è¦è´¸æ˜“å•†å“åŒ…æ‹¬å“ªäº›ï¼Ÿï¼ˆå¤šé€‰ï¼‰</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="toggleMultiOption(this, 0)">ä¸ç»¸</div>
                    <div class="quiz-option" onclick="toggleMultiOption(this, 1)">ç“·å™¨</div>
                    <div class="quiz-option" onclick="toggleMultiOption(this, 2)">èŒ¶å¶</div>
                    <div class="quiz-option" onclick="toggleMultiOption(this, 3)">ç«è¯</div>
                    <div class="quiz-option" onclick="toggleMultiOption(this, 4)">é¦™æ–™</div>
                    <div class="quiz-option" onclick="toggleMultiOption(this, 5)">çŸ³æ²¹</div>
                </div>
                <button class="quiz-submit" onclick="checkMultiAnswer(1, [0,1,2,4])">æäº¤ç­”æ¡ˆ</button>
                <div class="quiz-feedback" id="feedback-1" style="display: none;">
                    <p><strong>è§£æï¼š</strong>ä¸ç»¸ä¹‹è·¯ä¸Šçš„ä¸»è¦è´¸æ˜“å•†å“åŒ…æ‹¬ä¸­å›½çš„ä¸ç»¸ã€ç“·å™¨ã€èŒ¶å¶ï¼Œä»¥åŠè¥¿æ–¹çš„é¦™æ–™ç­‰ã€‚ç«è¯è™½ç„¶æ˜¯ä¸­å›½å‘æ˜ï¼Œä½†ä¸»è¦ç”¨äºå†›äº‹ï¼Œä¸æ˜¯ä¸»è¦è´¸æ˜“å•†å“ã€‚</p>
                </div>
            </div>
            
            <!-- åˆ¤æ–­é¢˜ -->
            <div class="quiz-question">
                <h4 class="text-xl font-bold text-foreground mb-4">ä¸ç»¸ä¹‹è·¯ä¸ä»…æ˜¯è´¸æ˜“é€šé“ï¼Œä¹Ÿæ˜¯æ–‡åŒ–äº¤æµçš„æ¡¥æ¢ã€‚</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectOption(this, 0)">æ­£ç¡®</div>
                    <div class="quiz-option" onclick="selectOption(this, 1)">é”™è¯¯</div>
                </div>
                <button class="quiz-submit" onclick="checkAnswer(2, [0])">æäº¤ç­”æ¡ˆ</button>
                <div class="quiz-feedback" id="feedback-2" style="display: none;">
                    <p><strong>è§£æï¼š</strong>ä¸ç»¸ä¹‹è·¯ç¡®å®ä¸ä»…ä»…æ˜¯è´¸æ˜“é€šé“ï¼Œæ›´æ˜¯ä¿ƒè¿›ä¸œè¥¿æ–¹æ–‡åŒ–ã€å®—æ•™ã€æŠ€æœ¯äº¤æµçš„é‡è¦æ¡¥æ¢ï¼Œå¯¹äººç±»æ–‡æ˜å‘å±•äº§ç”Ÿäº†æ·±è¿œå½±å“ã€‚</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // çœŸå®åœ°å›¾å’Œæ ‡è®°ç‚¹
        let map;
        let currentMarkers = [];
        let currentPolylines = [];
        
        // åŸå¸‚åœ°ç†åæ ‡æ•°æ®
        const cityCoordinates = {
            'chang-an': [34.3416, 108.9398], // è¥¿å®‰
            'dunhuang': [40.1424, 94.6624],
            'loulan': [40.5, 89.8],
            'kashi': [39.4704, 75.9896], // å–€ä»€
            'samarkand': [39.6270, 66.9750], // æ’’é©¬å°”ç½•
            'baghdad': [33.3152, 44.3661], // å·´æ ¼è¾¾
            'constantinople': [41.0082, 28.9784], // ä¼Šæ–¯å¦å¸ƒå°”
            'bukhara': [39.7747, 64.4286], // å¸ƒå“ˆæ‹‰
            'merv': [37.6667, 62.1833], // æ¢…å°”å¤«
            'herat': [34.3482, 62.1997], // èµ«æ‹‰ç‰¹
            'balkh': [36.7581, 66.8957], // å·´å°”èµ«
            'tashkent': [41.2995, 69.2401], // å¡”ä»€å¹²
            'almaty': [43.2220, 76.8512], // é˜¿æ‹‰æœ¨å›¾
            'turpan': [42.9513, 89.1898], // åé²ç•ª
            'yarkand': [38.4183, 77.2667], // å¶å°”ç¾Œ
            'khotan': [37.1167, 79.9167] // å’Œç”°
        };
        
        // æœä»£è·¯çº¿æ•°æ®
        const dynastyRoutes = {
            han: {
                cities: ['chang-an', 'dunhuang', 'loulan', 'kashi', 'samarkand'],
                routes: [
                    ['chang-an', 'dunhuang', 'loulan', 'kashi', 'samarkand']
                ],
                policies: {
                    'chang-an': ['å¼ éªå‡ºä½¿è¥¿åŸŸ', 'è®¾ç«‹è¥¿åŸŸéƒ½æŠ¤åºœ', 'å¼€è¾Ÿä¸ç»¸ä¹‹è·¯'],
                    'dunhuang': ['æ²³è¥¿èµ°å»Šè¦å¡', 'ä½›æ•™ä¼ æ’­ä¸­å¿ƒ'],
                    'kashi': ['è¥¿åŸŸé—¨æˆ·', 'è´¸æ˜“é›†æ•£åœ°']
                }
            },
            tang: {
                cities: ['chang-an', 'dunhuang', 'turpan', 'kashi', 'samarkand', 'bukhara', 'merv', 'baghdad'],
                routes: [
                    ['chang-an', 'dunhuang', 'turpan', 'kashi', 'samarkand', 'bukhara', 'merv', 'baghdad'],
                    ['chang-an', 'dunhuang', 'khotan', 'yarkand', 'kashi', 'samarkand']
                ],
                policies: {
                    'chang-an': ['å®‰è¥¿éƒ½æŠ¤åºœ', 'åŒ—åº­éƒ½æŠ¤åºœ', 'å›½é™…è´¸æ˜“ä¸­å¿ƒ'],
                    'samarkand': ['ç²Ÿç‰¹å•†äººç½‘ç»œ', 'æ–‡åŒ–äº¤æµæ¢çº½'],
                    'baghdad': ['é˜¿æ‹‰ä¼¯å¸å›½éƒ½åŸ', 'å­¦æœ¯æ–‡åŒ–ä¸­å¿ƒ']
                }
            },
            song: {
                cities: ['chang-an', 'dunhuang', 'kashi', 'samarkand', 'bukhara', 'baghdad', 'constantinople'],
                routes: [
                    ['chang-an', 'dunhuang', 'kashi', 'samarkand', 'bukhara', 'baghdad', 'constantinople']
                ],
                policies: {
                    'chang-an': ['å¸‚èˆ¶å¸åˆ¶åº¦', 'æµ·é™†å¹¶è¿›è´¸æ˜“'],
                    'constantinople': ['æ‹œå åº­è´¸æ˜“', 'ä¸œè¥¿æ–¹äº¤æ±‡ç‚¹'],
                    'samarkand': ['å¸–æœ¨å„¿å¸å›½', 'å»ºç­‘è‰ºæœ¯ä¸­å¿ƒ']
                }
            },
            ming: {
                cities: ['chang-an', 'dunhuang', 'kashi', 'samarkand'],
                routes: [
                    ['chang-an', 'dunhuang', 'kashi', 'samarkand']
                ],
                policies: {
                    'chang-an': ['æµ·ç¦æ”¿ç­–', 'æœè´¡è´¸æ˜“'],
                    'dunhuang': ['è¾¹é˜²è¦å¡', 'æ–‡åŒ–é—å­˜ä¿æŠ¤'],
                    'kashi': ['è¾¹å¢ƒè´¸æ˜“', 'æ°‘æ—èåˆ']
                }
            }
        };
        
        // åŸå¸‚ä¿¡æ¯æ•°æ®
        const cityData = {
            'chang-an': {
                name: 'é•¿å®‰ï¼ˆä»Šè¥¿å®‰ï¼‰',
                description: 'ä¸ç»¸ä¹‹è·¯çš„èµ·ç‚¹ï¼Œå”æœéƒ½åŸï¼Œå½“æ—¶ä¸–ç•Œä¸Šæœ€å¤§çš„åŸå¸‚ä¹‹ä¸€ã€‚äººå£è¶…è¿‡ç™¾ä¸‡ï¼Œæ±‡èšäº†æ¥è‡ªä¸–ç•Œå„åœ°çš„å•†äººã€ä½¿èŠ‚å’Œå­¦è€…ã€‚',
                importance: 'æ”¿æ²»ä¸­å¿ƒã€è´¸æ˜“èµ·ç‚¹ã€æ–‡åŒ–æ¢çº½',
                period: 'æ±‰å”æ—¶æœŸæœ€ä¸ºç¹è£'
            },
            'dunhuang': {
                name: 'æ•¦ç…Œ',
                description: 'æ²³è¥¿èµ°å»Šçš„é‡è¦èŠ‚ç‚¹ï¼Œä»¥è«é«˜çªŸé—»åã€‚æ˜¯ä¸ç»¸ä¹‹è·¯ä¸Šçš„é‡è¦è¡¥ç»™ç«™å’Œæ–‡åŒ–äº¤æµä¸­å¿ƒï¼Œä¿å­˜äº†å¤§é‡çè´µçš„æ–‡ç‰©å’Œå£ç”»ã€‚',
                importance: 'æ–‡åŒ–è‰ºæœ¯ä¸­å¿ƒã€å®—æ•™ä¼ æ’­åœ°ã€å•†é˜Ÿè¡¥ç»™ç«™',
                period: 'é­æ™‹å—åŒ—æœè‡³å”ä»£æœ€ä¸ºç¹è£'
            },
            'loulan': {
                name: 'æ¥¼å…°',
                description: 'å¤ä»£è¥¿åŸŸé‡è¦åŸé‚¦ï¼Œä½äºå¡”é‡Œæœ¨ç›†åœ°ã€‚æ›¾æ˜¯ä¸ç»¸ä¹‹è·¯å—é“çš„é‡è¦ä¸­è½¬ç«™ï¼Œåå› ç¯å¢ƒå˜åŒ–è€Œè¡°è½ï¼Œæˆä¸ºç¥ç§˜çš„å¤åŸé—å€ã€‚',
                importance: 'è´¸æ˜“ä¸­è½¬ç«™ã€å†›äº‹è¦åœ°',
                period: 'æ±‰æ™‹æ—¶æœŸç¹è£ï¼Œåé€æ¸è¡°è½'
            },
            'kashi': {
                name: 'å–€ä»€',
                description: 'ä½äºå¸•ç±³å°”é«˜åŸä¸œéº“ï¼Œæ˜¯ä¸ç»¸ä¹‹è·¯ä¸Šçš„é‡è¦æ¢çº½ã€‚è¿æ¥ä¸­äºšã€å—äºšå’Œä¸­å›½å†…åœ°çš„äº¤é€šè¦é“ï¼Œè‡³ä»Šä»æ˜¯é‡è¦çš„å•†è´¸åŸå¸‚ã€‚',
                importance: 'äº¤é€šæ¢çº½ã€å•†è´¸ä¸­å¿ƒã€æ–‡åŒ–äº¤æ±‡ç‚¹',
                period: 'å„ä¸ªå†å²æ—¶æœŸéƒ½å¾ˆé‡è¦'
            },
            'samarkand': {
                name: 'æ’’é©¬å°”ç½•',
                description: 'ä¸­äºšå¤åŸï¼Œä¸ç»¸ä¹‹è·¯ä¸Šçš„ç’€ç’¨æ˜ç ã€‚æ›¾æ˜¯å¤šä¸ªå¸å›½çš„éƒ½åŸï¼Œä»¥å…¶ç²¾ç¾çš„å»ºç­‘å’Œç¹è£çš„å•†ä¸šè€Œé—»åäºä¸–ã€‚',
                importance: 'æ”¿æ²»ä¸­å¿ƒã€å•†ä¸šæ¢çº½ã€å»ºç­‘è‰ºæœ¯ä¸­å¿ƒ',
                period: 'å„ä¸ªå†å²æ—¶æœŸéƒ½å¾ˆé‡è¦ï¼Œç‰¹åˆ«æ˜¯å¸–æœ¨å„¿æ—¶æœŸ'
            },
            'baghdad': {
                name: 'å·´æ ¼è¾¾',
                description: 'é˜¿æ‹‰ä¼¯å¸å›½çš„éƒ½åŸï¼Œä¼Šæ–¯å…°æ–‡æ˜çš„ä¸­å¿ƒã€‚åœ¨ä¸ç»¸ä¹‹è·¯è´¸æ˜“ä¸­æ‰®æ¼”é‡è¦è§’è‰²ï¼Œæ˜¯ä¸œè¥¿æ–¹å•†å“çš„é‡è¦é›†æ•£åœ°ã€‚',
                importance: 'æ”¿æ²»ä¸­å¿ƒã€å­¦æœ¯ä¸­å¿ƒã€è´¸æ˜“æ¢çº½',
                period: 'é˜¿æ‹”æ–¯ç‹æœæ—¶æœŸæœ€ä¸ºç¹è£'
            },
            'constantinople': {
                name: 'å›å£«å¦ä¸å ¡ï¼ˆä»Šä¼Šæ–¯å¦å¸ƒå°”ï¼‰',
                description: 'æ‹œå åº­å¸å›½çš„éƒ½åŸï¼Œä¸ç»¸ä¹‹è·¯çš„è¥¿ç«¯ç»ˆç‚¹ä¹‹ä¸€ã€‚è¿æ¥æ¬§äºšä¸¤æ´²ï¼Œæ˜¯ä¸œè¥¿æ–¹è´¸æ˜“çš„é‡è¦é—¨æˆ·ã€‚',
                importance: 'è´¸æ˜“ç»ˆç‚¹ã€æ–‡åŒ–äº¤æ±‡ç‚¹ã€æ”¿æ²»ä¸­å¿ƒ',
                period: 'æ‹œå åº­å¸å›½å’Œå¥¥æ–¯æ›¼å¸å›½æ—¶æœŸ'
            }
        };
        
        let currentPeriod = 'han';
        let currentDynasty = 'han';
        let audioPlaying = false;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeTimeline();
            initializeMap();
            showPeriod('han');
            switchDynasty('han');
        });
        
        // åˆå§‹åŒ–Leafletåœ°å›¾
        function initializeMap() {
            // åˆ›å»ºåœ°å›¾å®ä¾‹ï¼Œä¸­å¿ƒç‚¹è®¾åœ¨ä¸­äºš
            map = L.map('realMap').setView([40.0, 70.0], 4);
            
            // ä½¿ç”¨é«˜å¾·åœ°å›¾ç“¦ç‰‡
            L.tileLayer('https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}', {
                attribution: 'Â© é«˜å¾·åœ°å›¾',
                subdomains: ['1', '2', '3', '4'],
                maxZoom: 18
            }).addTo(map);
        }
        
        // åˆ‡æ¢æœä»£
        function switchDynasty(dynasty) {
            currentDynasty = dynasty;
            
            // æ¸…é™¤ç°æœ‰æ ‡è®°å’Œè·¯çº¿
            currentMarkers.forEach(marker => map.removeLayer(marker));
            currentPolylines.forEach(polyline => map.removeLayer(polyline));
            currentMarkers = [];
            currentPolylines = [];
            
            const dynastyData = dynastyRoutes[dynasty];
            
            // æ·»åŠ åŸå¸‚æ ‡è®°ç‚¹
            dynastyData.cities.forEach(cityId => {
                const coords = cityCoordinates[cityId];
                const cityInfo = cityData[cityId];
                const policies = dynastyData.policies[cityId] || [];
                
                if (coords && cityInfo) {
                    // åˆ›å»ºè‡ªå®šä¹‰å›¾æ ‡
                    const customIcon = L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="width: 20px; height: 20px; background: linear-gradient(135deg, #D4AF37, #FF6B35); border: 3px solid #FDF5E6; border-radius: 50%; box-shadow: 0 4px 12px rgba(212, 175, 55, 0.5);"></div>`,
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    });
                    
                    // åˆ›å»ºå¼¹çª—å†…å®¹
                    const popupContent = `
                        <div class="popup-title">${cityInfo.name}</div>
                        <div class="popup-description">${cityInfo.description}</div>
                        <div style="margin: 8px 0;">
                            <strong>é‡è¦åœ°ä½ï¼š</strong>${cityInfo.importance}<br>
                            <strong>ç¹è£æ—¶æœŸï¼š</strong>${cityInfo.period}
                        </div>
                        ${policies.length > 0 ? `
                        <div style="margin-top: 12px;">
                            <strong>ç›¸å…³æ”¿ç­–ï¼š</strong>
                            <div class="popup-tags">
                                ${policies.map(policy => `<span class="popup-tag" onclick="showPolicyDetail('${policy}')">${policy}</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                    `;
                    
                    const marker = L.marker(coords, { icon: customIcon })
                        .bindPopup(popupContent, {
                            maxWidth: 300,
                            className: 'custom-popup'
                        })
                        .addTo(map);
                    
                    currentMarkers.push(marker);
                }
            });
            
            // æ·»åŠ è·¯çº¿
            dynastyData.routes.forEach((route, index) => {
                const routeCoords = route.map(cityId => cityCoordinates[cityId]).filter(coord => coord);
                
                if (routeCoords.length > 1) {
                    const polyline = L.polyline(routeCoords, {
                        color: index === 0 ? '#D4AF37' : '#FF6B35',
                        weight: 4,
                        opacity: 0.8,
                        dashArray: '10, 5'
                    }).addTo(map);
                    
                    currentPolylines.push(polyline);
                }
            });
            
            // æ›´æ–°åœ°å›¾è§†å›¾ä»¥åŒ…å«æ‰€æœ‰æ ‡è®°ç‚¹
            if (currentMarkers.length > 0) {
                const group = new L.featureGroup(currentMarkers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }
        
        // æ˜¾ç¤ºæ”¿ç­–è¯¦æƒ…
        function showPolicyDetail(policy) {
            const policyDetails = {
                'å¼ éªå‡ºä½¿è¥¿åŸŸ': 'æ±‰æ­¦å¸æ—¶æœŸï¼Œå¼ éªä¸¤æ¬¡å‡ºä½¿è¥¿åŸŸï¼Œå¼€è¾Ÿäº†ä¸­åŸä¸è¥¿åŸŸçš„å¤–äº¤å’Œè´¸æ˜“é€šé“ï¼Œä¸ºä¸ç»¸ä¹‹è·¯çš„å½¢æˆå¥ å®šäº†åŸºç¡€ã€‚',
                'è®¾ç«‹è¥¿åŸŸéƒ½æŠ¤åºœ': 'æ±‰æœåœ¨è¥¿åŸŸè®¾ç«‹éƒ½æŠ¤åºœï¼ŒåŠ å¼ºå¯¹è¥¿åŸŸçš„ç®¡ç†ï¼Œä¿æŠ¤å•†é˜Ÿå®‰å…¨ï¼Œä¿ƒè¿›ä¸ç»¸ä¹‹è·¯è´¸æ˜“çš„å‘å±•ã€‚',
                'å¼€è¾Ÿä¸ç»¸ä¹‹è·¯': 'é€šè¿‡å¼ éªå‡ºä½¿å’Œåç»­çš„å¤–äº¤åŠªåŠ›ï¼Œæ­£å¼å¼€è¾Ÿäº†è¿æ¥ä¸œè¥¿æ–¹çš„ä¸ç»¸ä¹‹è·¯è´¸æ˜“é€šé“ã€‚',
                'æ²³è¥¿èµ°å»Šè¦å¡': 'æ•¦ç…Œä½äºæ²³è¥¿èµ°å»Šè¥¿ç«¯ï¼Œæ˜¯ä¸­åŸé€šå¾€è¥¿åŸŸçš„é‡è¦é—¨æˆ·å’Œå†›äº‹è¦å¡ã€‚',
                'ä½›æ•™ä¼ æ’­ä¸­å¿ƒ': 'æ•¦ç…Œè«é«˜çªŸæ˜¯ä½›æ•™è‰ºæœ¯çš„å®åº“ï¼Œè§è¯äº†ä½›æ•™æ²¿ä¸ç»¸ä¹‹è·¯çš„ä¼ æ’­è¿‡ç¨‹ã€‚',
                'è¥¿åŸŸé—¨æˆ·': 'å–€ä»€åœ°å¤„å¸•ç±³å°”é«˜åŸä¸œéº“ï¼Œæ˜¯è¿›å…¥ä¸­äºšçš„é‡è¦é—¨æˆ·ã€‚',
                'è´¸æ˜“é›†æ•£åœ°': 'ä½œä¸ºä¸ç»¸ä¹‹è·¯ä¸Šçš„é‡è¦èŠ‚ç‚¹ï¼Œå„ç§å•†å“åœ¨æ­¤é›†æ•£äº¤æ˜“ã€‚',
                'å®‰è¥¿éƒ½æŠ¤åºœ': 'å”æœåœ¨è¥¿åŸŸè®¾ç«‹çš„å†›æ”¿æœºæ„ï¼Œç®¡è¾–å¤©å±±å—è·¯å„å›½ã€‚',
                'åŒ—åº­éƒ½æŠ¤åºœ': 'å”æœåœ¨è¥¿åŸŸè®¾ç«‹çš„å¦ä¸€ä¸ªéƒ½æŠ¤åºœï¼Œç®¡è¾–å¤©å±±åŒ—è·¯ã€‚',
                'å›½é™…è´¸æ˜“ä¸­å¿ƒ': 'å”ä»£é•¿å®‰æ˜¯å½“æ—¶ä¸–ç•Œä¸Šæœ€å¤§çš„å›½é™…è´¸æ˜“ä¸­å¿ƒä¹‹ä¸€ã€‚',
                'ç²Ÿç‰¹å•†äººç½‘ç»œ': 'ç²Ÿç‰¹å•†äººå»ºç«‹äº†æ¨ªè·¨æ¬§äºšçš„å•†ä¸šç½‘ç»œï¼Œä¿ƒè¿›äº†ä¸ç»¸ä¹‹è·¯è´¸æ˜“ã€‚',
                'æ–‡åŒ–äº¤æµæ¢çº½': 'æ’’é©¬å°”ç½•æ˜¯é‡è¦çš„æ–‡åŒ–äº¤æµä¸­å¿ƒï¼Œå„ç§æ–‡æ˜åœ¨æ­¤äº¤æ±‡ã€‚',
                'é˜¿æ‹‰ä¼¯å¸å›½éƒ½åŸ': 'å·´æ ¼è¾¾æ˜¯é˜¿æ‹”æ–¯ç‹æœçš„éƒ½åŸï¼Œä¼Šæ–¯å…°æ–‡æ˜çš„ä¸­å¿ƒã€‚',
                'å­¦æœ¯æ–‡åŒ–ä¸­å¿ƒ': 'å·´æ ¼è¾¾çš„æ™ºæ…§å®«æ˜¯å½“æ—¶é‡è¦çš„å­¦æœ¯ç ”ç©¶ä¸­å¿ƒã€‚',
                'å¸‚èˆ¶å¸åˆ¶åº¦': 'å®‹ä»£å»ºç«‹çš„ç®¡ç†æµ·å¤–è´¸æ˜“çš„æœºæ„ã€‚',
                'æµ·é™†å¹¶è¿›è´¸æ˜“': 'å®‹ä»£å½¢æˆäº†é™†ä¸Šä¸ç»¸ä¹‹è·¯ä¸æµ·ä¸Šä¸ç»¸ä¹‹è·¯å¹¶è¡Œå‘å±•çš„æ ¼å±€ã€‚',
                'æ‹œå åº­è´¸æ˜“': 'å›å£«å¦ä¸å ¡æ˜¯æ‹œå åº­å¸å›½çš„éƒ½åŸï¼Œæ˜¯é‡è¦çš„è´¸æ˜“ä¸­å¿ƒã€‚',
                'ä¸œè¥¿æ–¹äº¤æ±‡ç‚¹': 'å›å£«å¦ä¸å ¡è¿æ¥æ¬§äºšä¸¤æ´²ï¼Œæ˜¯ä¸œè¥¿æ–¹è´¸æ˜“çš„é‡è¦æ¢çº½ã€‚',
                'å¸–æœ¨å„¿å¸å›½': '14-15ä¸–çºªæ’’é©¬å°”ç½•æ˜¯å¸–æœ¨å„¿å¸å›½çš„éƒ½åŸã€‚',
                'å»ºç­‘è‰ºæœ¯ä¸­å¿ƒ': 'æ’’é©¬å°”ç½•ä»¥å…¶ç²¾ç¾çš„ä¼Šæ–¯å…°å»ºç­‘è‰ºæœ¯è€Œé—»åã€‚',
                'æµ·ç¦æ”¿ç­–': 'æ˜æœå®è¡Œçš„é™åˆ¶æµ·å¤–è´¸æ˜“çš„æ”¿ç­–ã€‚',
                'æœè´¡è´¸æ˜“': 'æ˜æœä¸å‘¨è¾¹å›½å®¶è¿›è¡Œçš„ä»¥æœè´¡ä¸ºå½¢å¼çš„è´¸æ˜“ã€‚',
                'è¾¹é˜²è¦å¡': 'æ˜ä»£æ•¦ç…Œä¸»è¦ä½œä¸ºè¾¹é˜²è¦å¡å­˜åœ¨ã€‚',
                'æ–‡åŒ–é—å­˜ä¿æŠ¤': 'æ•¦ç…Œä¿å­˜äº†å¤§é‡çè´µçš„æ–‡åŒ–é—äº§ã€‚',
                'è¾¹å¢ƒè´¸æ˜“': 'æ˜ä»£å–€ä»€åœ°åŒºçš„è¾¹å¢ƒè´¸æ˜“æ´»åŠ¨ã€‚',
                'æ°‘æ—èåˆ': 'å¤šæ°‘æ—åœ¨ä¸ç»¸ä¹‹è·¯ä¸Šçš„äº¤æµä¸èåˆã€‚'
            };
            
            const detail = policyDetails[policy] || 'æš‚æ— è¯¦ç»†ä¿¡æ¯';
            
            // åˆ›å»ºè¯¦æƒ…å¼¹çª—
            const detailPopup = L.popup({
                maxWidth: 400,
                className: 'policy-detail-popup'
            })
            .setLatLng(map.getCenter())
            .setContent(`
                <div style="padding: 16px;">
                    <h3 style="color: #2F1B14; margin-bottom: 12px; font-size: 18px; font-weight: bold;">${policy}</h3>
                    <p style="color: #8B4513; line-height: 1.6; margin: 0;">${detail}</p>
                </div>
            `)
            .openOn(map);
        }
        
        // æ—¶é—´è½´åŠ¨ç”»åˆå§‹åŒ–
        function initializeTimeline() {
            const timelineItems = document.querySelectorAll('.timeline-item');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        anime({
                            targets: entry.target,
                            opacity: [0, 1],
                            translateY: [50, 0],
                            duration: 800,
                            easing: 'easeOutExpo',
                            delay: 200
                        });
                    }
                });
            }, { threshold: 0.1 });
            
            timelineItems.forEach(item => observer.observe(item));
        }
        
        // æ˜¾ç¤ºç‰¹å®šæ—¶æœŸ
        function showPeriod(period) {
            currentPeriod = period;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.period === period) {
                    btn.classList.add('active');
                }
            });
            
            // æ˜¾ç¤º/éšè—æ—¶é—´è½´é¡¹ç›®
            document.querySelectorAll('.timeline-item').forEach(item => {
                if (item.dataset.period === period) {
                    item.style.display = 'block';
                    anime({
                        targets: item,
                        opacity: [0, 1],
                        translateY: [30, 0],
                        duration: 600,
                        easing: 'easeOutExpo'
                    });
                } else {
                    item.style.display = 'none';
                }
            });
            
            // æ›´æ–°åœ°å›¾
            updateMap(period);
        }
        
        // æ›´æ–°åœ°å›¾æ˜¾ç¤º
        function updateMap(period) {
            // åŒæ­¥æ›´æ–°çœŸå®åœ°å›¾
            switchDynasty(period);
            
            // åŒæ­¥ä¸‹æ‹‰é€‰æ‹©å™¨
            document.getElementById('dynastySelect').value = period;
        }
        
        // æ˜¾ç¤ºåŸå¸‚ä¿¡æ¯
        function showCityInfo(cityId) {
            const city = cityData[cityId];
            const infoCard = document.getElementById('cityInfo');
            
            if (city) {
                infoCard.innerHTML = `
                    <h4 class="text-2xl font-bold text-foreground mb-3">${city.name}</h4>
                    <p class="text-secondary leading-relaxed mb-4">${city.description}</p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="font-bold text-foreground mb-2">é‡è¦åœ°ä½</h5>
                            <p class="text-secondary text-sm">${city.importance}</p>
                        </div>
                        <div>
                            <h5 class="font-bold text-foreground mb-2">ç¹è£æ—¶æœŸ</h5>
                            <p class="text-secondary text-sm">${city.period}</p>
                        </div>
                    </div>
                `;
                
                infoCard.classList.add('show');
            }
        }
        
        // èšç„¦æ—¶é—´è½´é¡¹ç›®
        function focusTimelineItem(dot) {
            // ç§»é™¤å…¶ä»–æ´»è·ƒçŠ¶æ€
            document.querySelectorAll('.timeline-dot').forEach(d => {
                d.classList.remove('active');
            });
            
            // æ·»åŠ æ´»è·ƒçŠ¶æ€
            dot.classList.add('active');
            
            // æ»šåŠ¨åˆ°è¯¥é¡¹ç›®
            dot.parentElement.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
            
            // æ·»åŠ è„‰å†²åŠ¨ç”»
            anime({
                targets: dot,
                scale: [1.3, 1.5, 1.3],
                duration: 800,
                easing: 'easeOutElastic(1, .8)'
            });
        }
        
        // éŸ³é¢‘æ§åˆ¶
        function toggleAudio() {
            const audio = document.getElementById('narratorAudio');
            const icon = document.getElementById('audioIcon');
            
            if (audioPlaying) {
                audio.pause();
                icon.textContent = 'ğŸ”Š';
                audioPlaying = false;
            } else {
                audio.play();
                icon.textContent = 'ğŸ”‡';
                audioPlaying = true;
            }
        }
        
        // éŸ³é¢‘äº‹ä»¶ç›‘å¬
        document.getElementById('narratorAudio').addEventListener('ended', function() {
            document.getElementById('audioIcon').textContent = 'ğŸ”Š';
            audioPlaying = false;
        });
        
        // å“åº”å¼å¤„ç†
        function handleResize() {
            if (window.innerWidth <= 768) {
                // ç§»åŠ¨ç«¯é€‚é…
                document.querySelectorAll('.timeline-item').forEach(item => {
                    item.classList.remove('left', 'right');
                    item.classList.add('left');
                });
            }
        }
        
        window.addEventListener('resize', handleResize);
        handleResize(); // åˆå§‹åŒ–æ—¶è°ƒç”¨
        
        // é¡µé¢åŠ è½½åŠ¨ç”»
        anime.timeline({
            easing: 'easeOutExpo',
            duration: 750
        })
        .add({
            targets: 'h1',
            opacity: [0, 1],
            translateY: [50, 0]
        })
        .add({
            targets: '.control-panel',
            opacity: [0, 1],
            translateY: [30, 0]
        }, '-=500')
        .add({
            targets: '.map-container',
            opacity: [0, 1],
            scale: [0.9, 1]
        }, '-=300');
        
        // çŸ¥è¯†é—®ç­”åŠŸèƒ½
        let currentSelections = {};
        
        function selectOption(element, index) {
            // æ¸…é™¤åŒä¸€é—®é¢˜ä¸­çš„æ‰€æœ‰é€‰æ‹©
            const questionElement = element.closest('.quiz-question');
            questionElement.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // æ ‡è®°å½“å‰é€‰æ‹©
            element.classList.add('selected');
            
            // ä¿å­˜é€‰æ‹©
            const questionIndex = Array.from(document.querySelectorAll('.quiz-question')).indexOf(questionElement);
            currentSelections[questionIndex] = [index];
        }
        
        function toggleMultiOption(element, index) {
            const questionElement = element.closest('.quiz-question');
            const questionIndex = Array.from(document.querySelectorAll('.quiz-question')).indexOf(questionElement);
            
            // åˆå§‹åŒ–å½“å‰é€‰æ‹©æ•°ç»„
            if (!currentSelections[questionIndex]) {
                currentSelections[questionIndex] = [];
            }
            
            // åˆ‡æ¢é€‰æ‹©çŠ¶æ€
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                currentSelections[questionIndex] = currentSelections[questionIndex].filter(i => i !== index);
            } else {
                element.classList.add('selected');
                currentSelections[questionIndex].push(index);
            }
        }
        
        function checkAnswer(questionIndex, correctAnswers) {
            const feedback = document.getElementById(`feedback-${questionIndex}`);
            const questionElement = document.querySelectorAll('.quiz-question')[questionIndex];
            
            if (!currentSelections[questionIndex] || currentSelections[questionIndex].length === 0) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼');
                return;
            }
            
            const isCorrect = JSON.stringify(currentSelections[questionIndex]) === JSON.stringify(correctAnswers);
            
            // æ˜¾ç¤ºæ­£ç¡®/é”™è¯¯çŠ¶æ€
            questionElement.querySelectorAll('.quiz-option').forEach((option, index) => {
                if (correctAnswers.includes(index)) {
                    option.classList.add('correct');
                } else if (currentSelections[questionIndex].includes(index) && !correctAnswers.includes(index)) {
                    option.classList.add('incorrect');
                }
            });
            
            // æ˜¾ç¤ºåé¦ˆ
            feedback.style.display = 'block';
            feedback.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            // ç¦ç”¨è¿›ä¸€æ­¥é€‰æ‹©
            questionElement.querySelectorAll('.quiz-option').forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // ç¦ç”¨æäº¤æŒ‰é’®
            questionElement.querySelector('.quiz-submit').disabled = true;
        }
        
        function checkMultiAnswer(questionIndex, correctAnswers) {
            const feedback = document.getElementById(`feedback-${questionIndex}`);
            const questionElement = document.querySelectorAll('.quiz-question')[questionIndex];
            
            if (!currentSelections[questionIndex] || currentSelections[questionIndex].length === 0) {
                alert('è¯·å…ˆé€‰æ‹©ç­”æ¡ˆï¼');
                return;
            }
            
            // å¯¹å¤šé€‰é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥é€‰æ‹©çš„ç­”æ¡ˆæ˜¯å¦å®Œå…¨åŒ¹é…æ­£ç¡®ç­”æ¡ˆ
            const selected = [...currentSelections[questionIndex]].sort();
            const correct = [...correctAnswers].sort();
            const isCorrect = JSON.stringify(selected) === JSON.stringify(correct);
            
            // æ˜¾ç¤ºæ­£ç¡®/é”™è¯¯çŠ¶æ€
            questionElement.querySelectorAll('.quiz-option').forEach((option, index) => {
                if (correctAnswers.includes(index)) {
                    option.classList.add('correct');
                } else if (currentSelections[questionIndex].includes(index) && !correctAnswers.includes(index)) {
                    option.classList.add('incorrect');
                }
            });
            
            // æ˜¾ç¤ºåé¦ˆ
            feedback.style.display = 'block';
            feedback.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            // ç¦ç”¨è¿›ä¸€æ­¥é€‰æ‹©
            questionElement.querySelectorAll('.quiz-option').forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // ç¦ç”¨æäº¤æŒ‰é’®
            questionElement.querySelector('.quiz-submit').disabled = true;
        }
    </script>
</body>
</html>